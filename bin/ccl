#!/bin/sh

arch=`uname -m`

LISP=/home/stas/lisp
DD=${LISP}/impl/ccl

if [ $arch = x86_64 ]
then
    KERNEL=lx86cl64
else
    KERNEL=lx86cl
fi

CCL=${DD}/${KERNEL}

export CCL_DEFAULT_DIRECTORY=${DD}

dump_core() {
    $CCL -n --load ${LISP}/configs/ccl.lisp -K utf-8 \
    --eval '(ccl:save-application (merge-pathnames "lisp/fasls/ccl-core" (user-homedir-pathname)))'
}

if [ ! -e ~/lisp/fasls/ccl-core ]; then
    dump_core
fi

$CCL -n -I ~/lisp/fasls/ccl-core -K utf-8 "$@"
